<footer>
  <div class="container">
    <div class="system-status">
      <span class="status-item"><i class="fas fa-clock"></i> Uptime: <span class="status-value">7300+ days</span></span>
      <span class="status-item"><i class="fas fa-heart"></i> Happiness: <span class="status-value">99.9%</span></span>
      <span class="status-item"><i class="fas fa-battery-three-quarters"></i> Redbull: <span class="status-value highlight">Critical</span></span>
    </div>
    <p>&copy; {{ 'now' | date: "%Y" }} {{site.data.blogger.name}}.</p>
    <p style="font-size: 0.9em; margin-top: 0.5rem; opacity: 0.6;">
      Built with <span style="color: var(--accent-secondary)">Jekyll</span> & <span style="color: var(--accent-primary)">CSS</span>
    </p>
  </div>
</footer>

<div class="ozone-gauge-container">
  <div class="gauge">
    <div id="gauge-needle" class="gauge-needle"></div>
  </div>
  <span class="gauge-label">Ozone Levels</span>
</div>

<div id="system-logs" class="system-logs"></div>

<!-- scripts -->
<script defer>
  // Matrix Rain Logic
  const canvas = document.getElementById('matrix-canvas');
  if (canvas) {
    const ctx = canvas.getContext('2d');
    let width = canvas.width = canvas.parentElement.offsetWidth;
    let height = canvas.height = canvas.parentElement.offsetHeight;
    
    const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789$Î»<>{}[]';
    const fontSize = 14;
    const columns = width / fontSize;
    const drops = [];

    for (let i = 0; i < columns; i++) {
      drops[i] = 1;
    }

    function draw() {
      ctx.fillStyle = 'rgba(3, 7, 18, 0.05)';
      ctx.fillRect(0, 0, width, height);
      ctx.fillStyle = '#38bdf8'; // accent-primary
      ctx.font = fontSize + 'px monospace';

      for (let i = 0; i < drops.length; i++) {
        const text = characters.charAt(Math.floor(Math.random() * characters.length));
        ctx.fillText(text, i * fontSize, drops[i] * fontSize);
        if (drops[i] * fontSize > height && Math.random() > 0.975) {
          drops[i] = 0;
        }
        drops[i]++;
      }
    }

    let matrixInterval = setInterval(draw, 33);

    window.addEventListener('resize', () => {
      width = canvas.width = canvas.parentElement.offsetWidth;
      height = canvas.height = canvas.parentElement.offsetHeight;
    });
  }

  // Kernel Panic Easter Egg
  const terminalHeader = document.querySelector('.terminal-header');
  const panicOverlay = document.getElementById('panic-overlay');
  const panicCountdown = document.getElementById('panic-countdown');
  let clickCount = 0;

  if (terminalHeader) {
    terminalHeader.addEventListener('click', () => {
      clickCount++;
      if (clickCount === 3) {
        triggerPanic();
        clickCount = 0;
      }
      setTimeout(() => { clickCount = 0; }, 1000);
    });
  }

  function triggerPanic() {
    panicOverlay.classList.add('active');
    let count = 5;
    const interval = setInterval(() => {
      count--;
      panicCountdown.textContent = count;
      if (count === 0) {
        clearInterval(interval);
        panicOverlay.classList.remove('active');
      }
    }, 1000);
  }

  // Ozone Gauge Logic
  const needle = document.getElementById('gauge-needle');
  let lastScrollTop = 0;
  let ozoneLevel = 0;

  window.addEventListener('scroll', () => {
    const st = window.pageYOffset || document.documentElement.scrollTop;
    const delta = Math.abs(st - lastScrollTop);
    
    // Increase ozone based on scroll speed
    ozoneLevel = Math.min(180, ozoneLevel + delta * 0.5);
    lastScrollTop = st <= 0 ? 0 : st;
  }, false);

  // Decays ozone over time
  setInterval(() => {
    ozoneLevel = Math.max(0, ozoneLevel - 2);
    // Map 0-180 to -90 to 90 degrees
    if (needle) {
      needle.style.transform = `translateX(-50%) rotate(${ozoneLevel - 90}deg)`;
    }
  }, 50);

  // Floating System Logs Logic
  const logsContainer = document.getElementById('system-logs');
  const quirkyMessages = [
    "[INFO] Squeezing GPU performance...",
    "[WARN] Red Bull level: LOW",
    "[DEBUG] Wrestling with Rust lifetimes...",
    "[INFO] Automating the automation...",
    "[DEBUG] Benchmarking distributed state...",
    "[WARN] Ozone levels rising âš¡",
    "[INFO] Deploying 30B request pipeline...",
    "[DEBUG] Refactoring box & arrow diagrams...",
    "[INFO] Statically linking sanity...",
    "[WARN] Borrow checker is unhappy ðŸ¦€"
  ];

  function addLog() {
    if (!logsContainer) return;
    const msg = quirkyMessages[Math.floor(Math.random() * quirkyMessages.length)];
    const logEntry = document.createElement('div');
    logEntry.className = 'log-entry';
    logEntry.textContent = msg;
    logsContainer.appendChild(logEntry);

    if (logsContainer.children.length > 5) {
      logsContainer.removeChild(logsContainer.firstChild);
    }

    setTimeout(() => {
      logEntry.classList.add('fade-out');
      setTimeout(() => {
        if (logEntry.parentNode) logEntry.parentNode.removeChild(logEntry);
      }, 2000);
    }, 4000);
  }

  setInterval(addLog, 5000);
  addLog();

  // Reading Progress Logic
  window.onscroll = function() {
    const winScroll = document.body.scrollTop || document.documentElement.scrollTop;
    const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
    const scrolled = (winScroll / height) * 100;
    document.getElementById("scroll-progress").style.width = scrolled + "%";
  };

  // Simple entry animations
  gsap.from("nav", { y: -50, opacity: 0, duration: 1, ease: "power3.out" });
  gsap.from("header", { opacity: 0, duration: 1.2, delay: 0.2 });
  gsap.from(".post, .project", { 
    y: 50, 
    opacity: 0, 
    duration: 0.8, 
    stagger: 0.1, 
    ease: "power2.out",
    delay: 0.5
  });
</script>
<script defer src="{{site.baseurl}}/assets/js/lbox.js"></script>